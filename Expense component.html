public class ValidateDuplicates implements SensiRulesValidations {

    @Override
    public void validate(List<SensiRow> sensiRows, InputValidationResponse response) {
        // Set to track unique keys
        Set<String> uniqueKeys = new HashSet<>();

        // Iterate through rows and check for duplicates
        for (SensiRow row : sensiRows) {
            if (row instanceof DeltaRow deltaRow) { // Only process DeltaRow instances
                String key = generateKey(deltaRow);
                if (!uniqueKeys.add(key)) {
                    // Update the response if a duplicate is found
                    updateErrorCountToRow(row, "Duplicate row found in the file.", null, response);
                }
            }
        }

        // Set the overall validation message
        setOverallMsg(response);
    }

    // Helper method to generate a unique key for identifying duplicates
    private String generateKey(DeltaRow row) {
        // Use reflection to dynamically create a key from all fields except deltaSensitivities
        return Arrays.stream(row.getClass().getDeclaredFields())
            .filter(field -> !field.getName().equalsIgnoreCase("deltaSensitivities"))
            .map(field -> {
                try {
                    field.setAccessible(true);
                    return String.valueOf(field.get(row));
                } catch (IllegalAccessException e) {
                    return "null";
                }
            })
            .collect(Collectors.joining("|")); // Create a unique key using "|"
    }
}
